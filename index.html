<link rel="manifest" href="manifest.json">

<head>
  <meta name="viewport" content="user-scalable = no">
  <title>SS Editor</title>
</head>

<style type="text/css">
  body{
    overscroll-behavior-y: none;
    touch-action: manipulation;
    /* font-family: "BIZUDPGothic-Regular.ttf";
    src: url(/BIZUDPGothic-Regular.ttf); */
  }
  textarea{
    font-family: inherit;
  }
</style>

<body>
  <meta charset="UTF-8">

      <!-- 上部2 -->
    <form name "top2" id="id_top2" action="">
      <!-- 上から分割点まで切り取り -->
      <input type = "button" value="分割切取り" style = "font-size: 200%; width:200px; height:80px; vertical-align: middle;" onclick="onButton_c_cut();" />

      <!-- 前回の分割ボイントから -->
      <textarea  id="id_c_row" type="text" style = "font-size: 200%; width:400px; height:80px; vertical-align: middle;" placeholder="直前の分割点から　0行" ></textarea>

      <!-- 分割ポイント -->
      <input type = "button" value="分割点挿入" style = "font-size: 200%; width:200px; height:80px; vertical-align: middle;" onclick="onButton_c_point();" />            
    </form>


    <!-- 上部 -->
    <form name "top" id="id_top" action="">
      <!-- 戻る -->
      <input id = "id_btn_back" type = "button" value="戻る" style = "font-size: 200%; width:150px; height:80px; vertical-align: middle;" onclick="onButton_back();" />

      <!-- 消去 -->
      <input type = "button" value="消去" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_del();" />

      <!-- 行数　byte -->
      <input  id="id_rows_byte_txt" type="text" style = "font-size: 200%; width:300px; height:80px; vertical-align: middle;" value="0 行 / 0 byte" disabled/>

      <!-- コピー -->
      <input type = "button" value="コピー" style = "font-size: 200%; width:150px; height:80px; vertical-align: middle;" onclick="onButton_copy();" />
     
      <!-- 選択リセット -->
      <input id = id_btn_reset type = "button" value="選択解除" style = "font-size: 200%; width:200px; height:80px; vertical-align: middle;" onclick="onButton_reset();" />      
    </form>
  
    
    <!-- テキストエリア -->
    <textarea id="id_text_box" name="text_box" type="text" style = "font-size: 100%; width:960px; height:450px; margin-bottom:20px;" oninput="onInput_text_box();"></textarea>
       
<!-- ------------------------------------------------------------------------ -->

    <!-- 選択欄１ -->
    <form name "select1" id="id_select1" action="">
      <!-- グループ変更 -->
      <input id = "id_btn_group1" type = "button" value="" style = "font-size: 200%; width:160px; height:80px; padding:0px; vertical-align: middle;" onclick="onButton_g1();" />

      <!-- キャラ変更 -->
      <input type = "button" value="▲" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_u1();" />
      <input type = "button" value="▼" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_d1();" />

      <!-- 選択 -->
      <input id = "id_btn_face1" type = "button" value="" style = "font-size: 200%; width:380px; height:80px; vertical-align: middle;" onclick="onButton_face1();" />

      <!-- 表情変更 -->
      <input type = "button" value="◀" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_l1();" />
      <input type = "button" value="▶" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_r1();" />      
    </form>

<!-- ------------------------------------------------------------------------ -->

    <!-- 選択欄２ -->
    <form name "select2" id="id_select2" action="">
      <!-- グループ変更 -->
      <input id = "id_btn_group2" type = "button" value="" style = "font-size: 200%; width:160px; height:80px; padding:0px; vertical-align: middle;" onclick="onButton_g2();" />

      <!-- キャラ変更 -->
      <input type = "button" value="▲" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_u2();" />
      <input type = "button" value="▼" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_d2();" />

      <!-- 選択 -->
      <input id = "id_btn_face2" type = "button" value="" style = "font-size: 200%; width:380px; height:80px; vertical-align: middle;" onclick="onButton_face2();" />

      <!-- 表情変更 -->
      <input type = "button" value="◀" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_l2();" />
      <input type = "button" value="▶" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_r2();" />
    </form>

<!-- ------------------------------------------------------------------------ -->

<!-- 選択欄３ -->
    <form name "select3" id="id_select3" action="">
      <!-- グループ変更 -->
      <input id = "id_btn_group3" type = "button" value="" style = "font-size: 200%; width:160px; height:80px; padding:0; vertical-align: middle;" onclick="onButton_g3();" />

      <!-- キャラ変更 -->
      <input type = "button" value="▲" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_u3();" />
      <input type = "button" value="▼" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_d3();" />

      <!-- 選択 -->
      <input id = "id_btn_face3" type = "button" value="" style = "font-size: 200%; width:380px; height:80px; vertical-align: middle;" onclick="onButton_face3();" />

      <!-- 表情変更 -->
      <input type = "button" value="◀" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_l3();" />
      <input type = "button" value="▶" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_r3();" />
    </form>

<!-- ------------------------------------------------------------------------ -->

<!-- 選択欄４ -->
    <form name "select4" id="id_select4" action="">
      <!-- グループ変更 -->
      <input id = "id_btn_group4" type = "button" value="" style = "font-size: 200%; width:160px; height:80px; padding:0; vertical-align: middle;" onclick="onButton_g4();" />

      <!-- キャラ変更 -->
      <input type = "button" value="▲" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_u4();" />
      <input type = "button" value="▼" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_d4();" />

      <!-- 選択 -->
      <input id = "id_btn_face4" type = "button" value="" style = "font-size: 200%; width:380px; height:80px; vertical-align: middle;" onclick="onButton_face4();" />

      <!-- 表情変更 -->
      <input type = "button" value="◀" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_l4();" />
      <input type = "button" value="▶" style = "font-size: 200%; width:100px; height:80px; vertical-align: middle;" onclick="onButton_r4();" />
    </form>

<!-- ------------------------------------------------------------------------ -->

    <!-- 入力欄 -->
    <form name "form1" id="id_form1" action="">
      <input id = id_btn_kakko1 type = "button" value="「」" style = "font-size: 200%; width:120px; height:80px; vertical-align: middle;" onclick="onButton_kakko1();" />

      <textarea name="id_textbox1" id="id_textbox1" type="text" value="" style = "font-size: 150%; width:670px; height:80px; vertical-align: middle;" oninput="onInput_textbox1();"></textarea>

      <input type = "button" value="追記" style = "font-size: 200%; width:160px; height:80px; vertical-align: middle;" onclick="onButton_w1();" />
    </form>
   

    <br><br>
    
    <!-- 読込 -->
    <input id = id_read type = "file" style = "font-size: 200%; width:700px; height:100px;" accept=".xlsx" onclick="onButton_read();" />

    <br><br>
    
    <a href="./new_cha_data.xlsx" style = "font-size: 200%;">キャラクターデータ雛形（xlsx）</a>   

    <br><br>

    <p>
      キーボードショートカット一覧<br>
      ctrl + Enter     ： 追記（TAB→EnterでもOK）<br>
      F1～F4           ：選択ラインの切り替え<br>
      F5               ： ライン選択の初期化<br>
      ctrl + g         ： グループ切り替え<br>
      ctrl + i         ： キャラクター変更、逆方向<br>
      ctrl + k         ： キャラクター変更、順方向<br>
      ctrl + j         ： 表情、表記ゆれ変更、逆方向<br>
      ctrl + l         ： 情、表記ゆれ変更、順方向<br>
      ctrl + [         ： 括弧の変更<br>
      ctrl + BackSpace ： 一つ前に戻る<br>
    </p>
  
    <br><br>

    <p>ここのQRコード</p>
    <img src="QR_SSEd.png">
    <!-- <a href="./manual.html" style = "font-size: 200%;">マニュアル</a>    -->

<!-- ----------------------------------------------------------------------------->

<!-- SheetJSライブラリ使用 -->
<!-- <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script> -->
<script src="xlsx.full.min.js"></script>

    <script>

      //PWA適用js読み込み
      window.addEventListener('load', function() {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register("sw.js");
      }
      })

      var ctrl_tf = false

      var c_word = "       <<*ここで*>>⊂⎛(cV„Ò ᴗ ÓV⎞⊃<<*分割！*>>"
      var c_count = 0

      select_line_save = 0//選択ラインの記憶用　キャラ選択

      var del_tmp = ""
      var input_back = ""
      var textbox_back = ""

      //キャラクターデータ
      var cha_data = [
        ["予備1","予備2","予備3","予備4","予備5","予備6","予備7","予備8","一人称","二人称","グループ名","名前","パターン1","パターン2","パターン3","パターン4"],
        ["","","","","","","","","わたし","あなた","μ's","穂乃果","リ`・ヮ・)","リ´＾ヮ＾)","リ｀・-・) ",""],
        ["","","","","","","","","わたし","あなた","μ's","絵里","∬cVσ_σv","","",""],
        ["","","","","","","","","わたし、ことり","あなた","μ's","ことり","(・8・)","(＾8＾)","9cﾊσ ᴗσﾘ",""],
        ["","","","","","","","","わたし","あなた","μ's","海未","/cVσ_VσV","/cV ;σ_VσV","",""],
        ["","","","","","","","","凛","ー","μ's","凛","＞ω＜/","ネッコ","",""],
        ["","","","","","","","","わたし","あなた","μ's","真姫","从廿_廿从","まきちゃん","",""],
        ["","","","","","","","","ウチ","あなた","μ's","希","╭*(๑˘ᴗ˘๑)*╮","","",""],
        ["","","","","","","","","わたし","あなた","μ's","花陽","从*´ ヮ`ﾙ","ｲw´ヮ`)ﾊ","",""],
        ["","","","","","","","","わたし、にこ","アンタ、あなた","μ's","にこ","J(*‘ヮ‘*)し","","",""],
        ["","","","","","","","","わたし","あなた","Aqours","千歌","从c*・ヮ・§","从c^ヮ^§","从c*˘･з･˘§",""],
        ["","","","","","","","","わたし","あなた","Aqours","梨子","ﾒｲ*σ _ σﾘ","ﾒｲ*,> _ <,ﾘ","ﾒﾉ＾ﾉ｡ ＾ﾘ",""],
        ["","","","","","","","","わたし","キミ","Aqours","果南","∫∫( c||^ヮ^||","∫∫( c||#^ヮ^||","∫∫( c||•ヮ•||",""],
        ["","","","","","","","","わたくし","あなた","Aqours","ダイヤ","|c||^.- ^||","|c||´.-｀||","|c||;　ﾛ　||　゜.゜",""],
        ["","","","","","","","","わたし","キミ","Aqours","曜","(*> ᴗ •*)ゞ","(*> ᴗ ;*)ゞ","ﾒﾒ´- ﾝﾄ",""],
        ["","","","","","","","","わたし、ヨハネ","アンタ、あなた","Aqours","善子","`¶cﾘ˘ヮ˚)|","●","`¶cﾘ˘～˚)",""],
        ["","","","","","","","","マル","ー","Aqours","花丸","ﾉcﾉ,,･o･,,ﾉﾚ","ﾉcﾉ,,･ᴗ･,,ﾉﾚ","ﾉcﾉ,,｀o´,,ﾉﾚ",""],
        ["","","","","","","","","わたし、マリー","あなた","Aqours","鞠莉","ﾉξｿ´・ω・`ﾊ6","ﾉξｿ´；ω；`ﾊ6","",""],
        ["","","","","","","","","ルビィ","ー","Aqours","ルビィ","⌒°( ･ω･)°⌒","⌒°( ^ω^)°⌒","⌒°(#･ω･)°⌒",""],
        ["","","","","","","","","わたし","あなた","虹ヶ咲","歩夢","@cﾒ*˶ˆ ᴗ ˆ˵ﾘ","@cﾒ*˘ ᴗ ˘ﾘ","@cﾒ*◉ _ ◉ ﾘ","₍₍ @cﾒ*˶ˆ ᴗ ˆ˵ 三*˶ˆ ᴗ ˆ˵ﾘ ⁾⁾ "],
        ["","","","","","","","","かすみん、わたし","ー","虹ヶ咲","かすみ","从cι˘σ ᴗ σ˘*","从cι˘σ □ σ˘*","从cι˘＞ □ ＜˘*",""],
        ["","","","","","","","","わたし","あなた","虹ヶ咲","しずく","jΣﾐｲ˶º ᴗº˶ﾘ","jΣﾐｲ˶º - º˶ﾘ","jΣﾐｲ˶º ^º˶ﾘ",""],
        ["","","","","","","","","わたし","あなた","虹ヶ咲","果林","(ζﾙ ˘ ᴗ ˚ ﾙﾍ","(ζﾙ|˘ᴗ°ﾙ","八丈島",""],
        ["","","","","","","","","愛さん、アタシ","キミ、アンタ","虹ヶ咲","愛","ζ㎗òヮóﾘ","ζ㎗Ō ᴗ Ōﾘ","",""],
        ["","","","","","","","","彼方ちゃん、私","あなた","虹ヶ咲","彼方","ﾉﾚcｲ´=ω=)","ﾉﾚcｲ* ¯ ꒳¯*)","",""],
        ["","","","","","","","","わたし","あなた","虹ヶ咲","せつ菜","⁄/*ｲ`＾ᗜ＾ﾘ","⁄/*ｲ`>ヮ<ﾘ","╭(^O^)",""],
        ["","","","","","","","","わたし","あなた","虹ヶ咲","エマ","╰*(..•ヮ•.. ) *╯",",,(d!.•ヮ•..)",",,(d!.˘ ヮ ˘..)","スイス"],
        ["","","","","","","","","わたし","あなた","虹ヶ咲","璃奈","从[˶˃ᴗ˂˵]从","从[´・֊・]从","从´・֊[ >ᴗ<]",""],
        ["","","","","","","","","私","あなた","虹ヶ咲","栞子","ᶘｲ^⇁^ﾅ川","ᶘｲ˘⇁˘ﾅ川","",""],
        ["","","","","","","","","ボク","キミ","虹ヶ咲","ミア","ζ ﾉᴗ ˘´Y","ζ ﾉ､ ˘´Y ","ｲdﾉﾉ . τlﾉ",""],
        ["","","","","","","","","ランジュ、アタシ","アナタ","虹ヶ咲","嵐珠","ʃcʃ|.ò ᴗ ó)ʅ","ʃcʃ|.Ō ᴗ Ō)ʅ","ランジュ","ዖ⦇d ò ヮ óﾘየ"],
        ["","","","","","","","","わたし","あなた","虹ヶ咲","侑","⎛(cV„Ò ᴗ ÓV⎞","⎛(cV„Ō ᴗ ŌV⎞","⎛(cV„Ó ᴗ ÒV⎞","⎛(cV„◜ᴗ◝V⎞"],
        ["","","","","","","","","わたし","ー","Liella!","かのん","ﾉcﾉﾉσﾉᴗ σb","|c||σノヮσ||","/ﾙcﾉº'ᴗº)",""],
        ["","","","","","","","","可可","ー","Liella!","可可","6cƠᴗƠ∂","クゥクゥ","",""],
        ["","","","","","","","","わたし","ー","Liella!","千砂都","၄(cʸ„ò ᴗ óﾘ၃",",O(d,,O ᴗ O,,)O、","",""],
        ["","","","","","","","","わたし","ー","Liella!","すみれ","/㍵ƺ˚ヮˆ)ƺ","","",""],
        ["","","","","","","","","わたくし","ー","Liella!","恋","ʃt(c◜・ᴗ・)","⌠t(cｲ´A`Y","",""],
        ["","","","","","","","","きな子","ー","Liella!","きな子","╭∞( ' ᗜ ' )∞╮","","",""],
        ["","","","","","","","","私","ー","Liella!","メイ","(cࡘ„ò ωò*ᘔ","","",""],
        ["","","","","","","","","私","ー","Liella!","四季","(.ɖ¡/ơ . ơy","","",""],
        ["","","","","","","","","私","ー","Liella!","夏美","§ ˘σ ᴗ σ˘§","§ σ ﹏σ§","CEO",""],
        ["","","","","","","","","","","Liella!","ウィーン","","","",""],
        ["","","","","","","","","","","その他","ツバサ","从σ ᴗ σ从","","",""],
        ["","","","","","","","","","","その他","英玲奈","ﾉqｲ`σﾉ_σ.ｱ","ロボ","",""],
        ["","","","","","","","","","","その他","あんじゅ","ﾉ(δ . δ,,ﾌﾉし","フルハウス","",""],
        ["","","","","","","","","","","その他","聖良","(q|`˘ ᴗ˘)ʅʅ","（q|˘・ᴗ・˘)ʅʅ","⌒°(q|˶^ ᴗ^˶)°⌒",""],
        ["","","","","","","","","","","その他","理亞","ﾉJ(´σ_ σ`ﾘﾉし","","",""],
        ["","","","","","","","","","","その他","遥","ζ(*^ᴗ^*)ζ","","",""],
        ["","","","","","","","","","","その他","美里","","","",""],
        ["","","","","","","","","","","その他","摩央","","","",""],
        ["","","","","","","","","","","その他","悠奈","( ᐛ👐)","","",""],
        ["","","","","","","","","","","その他","？？？","(Ｕ╯ꈊ╰Ｕ)","/cVσ 8 σV","",""]
      ]

      //呼び名データ
      var call_data = [
        ["","","呼ばれる人物","呼ばれ方","呼ぶ人物1","呼ぶ人物2","呼ぶ人物3","呼ぶ人物4","呼ぶ人物5","呼ぶ人物6","呼ぶ人物7","呼ぶ人物8","呼ぶ人物9","呼ぶ人物10","呼ぶ人物11","呼ぶ人物12","呼ぶ人物13","呼ぶ人物14","呼ぶ人物15","呼ぶ人物16","呼ぶ人物17","呼ぶ人物18"],
        ["","","歩夢","歩夢ちゃん","穂乃果","ことり","希","千歌","曜","梨子","果南","彼方","エマ","","","","","","","","",""],
        ["","","歩夢","歩夢さん","凛","花陽","花丸","ルビィ","ダイヤ","せつ菜","璃奈","しずく","栞子","","","","","","","","",""],
        ["","","歩夢","歩夢先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","歩夢","歩夢","侑","海未","真姫","にこ","絵里","善子","鞠莉","愛","果林","ミア","嵐珠","","","","","","",""],
        ["","","かすみ","かすみちゃん","穂乃果","ことり","花陽","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","璃奈","彼方","エマ","果林","侑","","",""],
        ["","","かすみ","かすみさん","ダイヤ","せつ菜","しずく","栞子","","","","","","","","","","","","","",""],
        ["","","かすみ","かすかすちゃん","果林","","","","","","","","","","","","","","","","",""],
        ["","","かすみ","かすかすさん","せつ菜","","","","","","","","","","","","","","","","",""],
        ["","","かすみ","子犬ちゃん","ミア","","","","","","","","","","","","","","","","",""],
        ["","","かすみ","かすかす","善子","愛","璃奈","彼方","","","","","","","","","","","","","",""],
        ["","","かすみ","かすみん","凛","希","愛","かすみ","","","","","","","","","","","","","",""],
        ["","","かすみ","かすみ","海未","真姫","にこ","絵里","善子","鞠莉","嵐珠","ミア","","","","","","","","","",""],
        ["","","しずく","しずくちゃん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","璃奈","彼方","エマ","果林","侑",""],
        ["","","しずく","しずくさん","ダイヤ","せつ菜","栞子","","","","","","","","","","","","","","",""],
        ["","","しずく","しず子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","しずく","しずく","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","果林","果林ちゃん","希","果南","彼方","エマ","","","","","","","","","","","","","",""],
        ["","","果林","果林さん","穂乃果","ことり","凛","花陽","千歌","曜","梨子","花丸","ルビィ","ダイヤ","歩夢","せつ菜","璃奈","しずく","栞子","侑","",""],
        ["","","果林","果林先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","果林","カリン","愛","","","","","","","","","","","","","","","","",""],
        ["","","果林","果林","海未","真姫","にこ","絵里","善子","鞠莉","嵐珠","ミア","","","","","","","","","",""],
        ["","","愛","愛ちゃん","穂乃果","ことり","希","千歌","曜","梨子","果南","歩夢","彼方","エマ","侑","美里","","","","","",""],
        ["","","愛","愛さん","凛","花陽","花丸","ルビィ","ダイヤ","愛","せつ菜","璃奈","しずく","栞子","","","","","","","",""],
        ["","","愛","愛先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","愛","愛","海未","真姫","にこ","絵里","善子","鞠莉","果林","嵐珠","ミア","","","","","","","","",""],
        ["","","美里","おねーちゃん","愛","","","","","","","","","","","","","","","","",""],
        ["","","彼方","彼方ちゃん","果南","エマ","彼方","","","","","","","","","","","","","","",""],
        ["","","彼方","彼方さん","穂乃果","ことり","凛","花陽","千歌","曜","梨子","花丸","ルビィ","ダイヤ","歩夢","せつ菜","璃奈","しずく","栞子","侑","",""],
        ["","","彼方","彼方先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","彼方","カナちゃん","希","愛","","","","","","","","","","","","","","","",""],
        ["","","彼方","彼方","海未","真姫","にこ","絵里","善子","鞠莉","果林","嵐珠","ミア","","","","","","","","",""],
        ["","","彼方","お姉ちゃん","遥","","","","","","","","","","","","","","","","",""],
        ["","","せつ菜","せつ菜ちゃん","穂乃果","ことり","希","千歌","曜","梨子","果南","歩夢","彼方","エマ","侑","","","","","","",""],
        ["","","せつ菜","せつ菜さん","凛","花陽","花丸","ルビィ","ダイヤ","璃奈","しずく","栞子","","","","","","","","","",""],
        ["","","せつ菜","せつ菜先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","せつ菜","せっちゃん","鞠莉","","","","","","","","","","","","","","","","",""],
        ["","","せつ菜","せっつー","愛","","","","","","","","","","","","","","","","",""],
        ["","","せつ菜","せつ菜","海未","真姫","にこ","絵里","善子","果林","嵐珠","ミア","","","","","","","","","",""],
        ["","","エマ","エマちゃん","東條希","果南","彼方","","","","","","","","","","","","","","",""],
        ["","","エマ","エマさん","穂乃果","ことり","凛","花陽","千歌","曜","梨子","花丸","ルビィ","ダイヤ","歩夢","せつ菜","璃奈","しずく","栞子","侑","",""],
        ["","","エマ","エマっち","愛","","","","","","","","","","","","","","","","",""],
        ["","","エマ","エマ先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","エマ","エマ","海未","真姫","にこ","絵里","善子","鞠莉","果林","嵐珠","ミア","","","","","","","","",""],
        ["","","璃奈","璃奈ちゃん","穂乃果","ことり","凛","花陽","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","彼方","エマ","果林","侑","","",""],
        ["","","璃奈","璃奈さん","ダイヤ","せつ菜","しずく","栞子","","","","","","","","","","","","","",""],
        ["","","璃奈","りなっち","希","","","","","","","","","","","","","","","","",""],
        ["","","璃奈","りなりー","愛","","","","","","","","","","","","","","","","",""],
        ["","","璃奈","りな子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","璃奈","璃奈","海未","真姫","にこ","絵里","善子","鞠莉","嵐珠","ミア","","","","","","","","","",""],
        ["","","栞子","しおってぃー","愛","","","","","","","","","","","","","","","","",""],
        ["","","栞子","栞子ちゃん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","璃奈","彼方","エマ","果林","侑",""],
        ["","","栞子","栞子さん","ダイヤ","せつ菜","しずく","","","","","","","","","","","","","","",""],
        ["","","栞子","しお子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","栞子","栞子","海未","真姫","にこ","絵里","善子","鞠莉","嵐珠","ミア","薫子","","","","","","","","",""],
        ["","","ミア","ミアちゃん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","璃奈","彼方","エマ","侑","",""],
        ["","","ミア","ミアさん","ダイヤ","せつ菜","しずく","栞子","","","","","","","","","","","","","",""],
        ["","","ミア","ミア子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","ミア","ミアチ ","愛","","","","","","","","","","","","","","","","",""],
        ["","","ミア","ミア","海未","真姫","にこ","絵里","善子","鞠莉","愛","果林","嵐珠","","","","","","","","",""],
        ["","","嵐珠","ランジュ先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","嵐珠","ショウ・ランジュ","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","嵐珠","ランジュちゃん","穂乃果","ことり","希","千歌","曜","梨子","果南","歩夢","彼方","エマ","侑","","","","","","",""],
        ["","","嵐珠","ランジュさん","凛","花陽","花丸","ルビィ","ダイヤ","せつ菜","璃奈","しずく","","","","","","","","","",""],
        ["","","嵐珠","ランジュ","海未","真姫","にこ","絵里","善子","鞠莉","愛","果林","栞子","ミア","ランジュ","","","","","","",""],
        ["","","侑","侑ちゃん","歩夢","彼方","エマ","","","","","","","","","","","","","","",""],
        ["","","侑","侑先輩","かすみ","しずく","","","","","","","","","","","","","","","",""],
        ["","","侑","侑さん","しずく","せつ菜","璃奈","栞子","","","","","","","","","","","","","",""],
        ["","","侑","ゆうゆ","愛","","","","","","","","","","","","","","","","",""],
        ["","","侑","ベイビーちゃん","ミア","","","","","","","","","","","","","","","","",""],
        ["","","侑","侑","果林","嵐珠","","","","","","","","","","","","","","","",""],
        ["","","千歌","千歌ちゃん","穂乃果","ことり","曜","梨子","歩夢","彼方","エマ","果林","侑","花丸","ルビィ","","","","","","",""],
        ["","","千歌","千歌先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","千歌","千歌さん","凛","花陽","ダイヤ","せつ菜","璃奈","しずく","栞子","","","","","","","","","","",""],
        ["","","千歌","チカッチ","希","鞠莉","愛","","","","","","","","","","","","","","",""],
        ["","","千歌","千歌","海未","真姫","にこ","絵里","善子","果南","嵐珠","ミア","志満","美渡","","","","","","","",""],
        ["","","梨子","梨子ちゃん","穂乃果","ことり","希","千歌","曜","花丸","ルビィ","果南","歩夢","彼方","エマ","果林","侑","","","","",""],
        ["","","梨子","梨子さん","凛","花陽","ダイヤ","せつ菜","しずく","璃奈","栞子","","","","","","","","","","",""],
        ["","","梨子","梨子先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","梨子","梨子","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","梨子","リリー","善子","","","","","","","","","","","","","","","","",""],
        ["","","果南","果南ちゃん","希","千歌","曜","梨子","花丸","ルビィ","彼方","エマ","果林","","","","","","","","",""],
        ["","","果南","果南先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","果南","果南さん","穂乃果","ことり","凛","花陽","ダイヤ","歩夢","せつ菜","璃奈","しずく","栞子","侑","","","","","","",""],
        ["","","果南","果南","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","ダイヤ","ダイヤちゃん","彼方","エマ","","","","","","","","","","","","","","","",""],
        ["","","ダイヤ","ダイヤさん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","花丸","歩夢","せつ菜","璃奈","しずく","栞子","果林","侑","",""],
        ["","","ダイヤ","ダイヤ先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","ダイヤ","お姉ちゃん","ルビィ","","","","","","","","","","","","","","","","",""],
        ["","","ダイヤ","ダイヤ","海未","真姫","にこ","絵里","善子","果南","鞠莉","愛","嵐珠","ミア","","","","","","","",""],
        ["","","曜","曜ちゃん","穂乃果","ことり","希","千歌","梨子","花丸","ルビィ","歩夢","彼方","エマ","果林","侑","","","","","",""],
        ["","","曜","曜さん","凛","花陽","ダイヤ","せつ菜","璃奈","しずく","栞子","","","","","","","","","","",""],
        ["","","曜","曜先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","曜","曜","海未","真姫","にこ","絵里","善子","果南","鞠莉","愛","嵐珠","ミア","","","","","","","",""],
        ["","","善子","善子ちゃん","花陽","歩夢","璃奈","彼方","エマ","穂乃果","ことり","凛","希","千歌","曜","梨子","花丸","ルビィ","果南","果林","侑",""],
        ["","","善子","善子さん","しずく","栞子","ダイヤ","せつ菜","","","","","","","","","","","","","",""],
        ["","","善子","善子","海未","真姫","にこ","絵里","鞠莉","愛","嵐珠","ミア","","","","","","","","","",""],
        ["","","善子","ヨハネちゃん","花陽","歩夢","璃奈","彼方","エマ","","","","","","","","","","","","",""],
        ["","","善子","ヨハネさん","しずく","栞子","","","","","","","","","","","","","","","",""],
        ["","","善子","ヨハ子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","花丸","ずら丸ちゃん","愛","","","","","","","","","","","","","","","","",""],
        ["","","花丸","ずら丸","善子","","","","","","","","","","","","","","","","",""],
        ["","","花丸","マル子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","花丸","花丸ちゃん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","ルビィ","果南","歩夢","璃奈","彼方","エマ","果林","侑","",""],
        ["","","花丸","花丸さん","ダイヤ","せつ菜","しずく","栞子","","","","","","","","","","","","","",""],
        ["","","花丸","花丸","海未","真姫","にこ","絵里","鞠莉","嵐珠","ミア","","","","","","","","","","",""],
        ["","","鞠莉","鞠莉ちゃん","希","千歌","曜","梨子","花丸","ルビィ","彼方","エマ","果林","","","","","","","","",""],
        ["","","鞠莉","鞠莉さん","穂乃果","ことり","凛","花陽","ダイヤ","歩夢","せつ菜","璃奈","しずく","栞子","侑","","","","","","",""],
        ["","","鞠莉","鞠莉先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","鞠莉","鞠莉","海未","真姫","にこ","絵里","善子","果南","嵐珠","ミア","","","","","","","","","",""],
        ["","","鞠莉","マリー","愛","","","","","","","","","","","","","","","","",""],
        ["","","ルビィ","ルビィちゃん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","花丸","果南","歩夢","璃奈","彼方","エマ","果林","侑","",""],
        ["","","ルビィ","ルビィさん","せつ菜","しずく","栞子","","","","","","","","","","","","","","",""],
        ["","","ルビィ","ルビィ","海未","真姫","にこ","絵里","善子","ダイヤ","鞠莉","愛","嵐珠","ミア","","","","","","","",""],
        ["","","ルビィ","ルビ子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","穂乃果","穂乃果ちゃん","ことり","凛","花陽","希","千歌","曜","梨子","果南","歩夢","彼方","エマ","果林","侑","","","","",""],
        ["","","穂乃果","穂乃果さん","花丸","ルビィ","ダイヤ","せつ菜","璃奈","しずく","栞子","","","","","","","","","","",""],
        ["","","穂乃果","穂乃果先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","穂乃果","穂乃果","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","穂乃果","お姉ちゃん","雪穂","","","","","","","","","","","","","","","","",""],
        ["","","絵里","絵里ちゃん","穂乃果","ことり","凛","花陽","果南","彼方","エマ","果林","","","","","","","","","",""],
        ["","","絵里","絵里さん","千歌","曜","梨子","花丸","ルビィ","歩夢","せつ菜","璃奈","しずく","栞子","侑","ダイヤ","","","","","",""],
        ["","","絵里","絵里先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","絵里","絵里","海未","にこ","善子","嵐珠","鞠莉","","","","","","","","","","","","",""],
        ["","","絵里","エリーチカさん","ダイヤ","","","","","","","","","","","","","","","","",""],
        ["","","絵里","エリーチカ","鞠莉","","","","","","","","","","","","","","","","",""],
        ["","","絵里","エリー","真姫","愛","ミア","","","","","","","","","","","","","","",""],
        ["","","絵里","えりち","希","","","","","","","","","","","","","","","","",""],
        ["","","絵里","お姉ちゃん","亜里沙","","","","","","","","","","","","","","","","",""],
        ["","","ことり","ことりちゃん","穂乃果","凛","花陽","希","千歌","曜","梨子","果南","歩夢","彼方","エマ","果林","侑","","","","",""],
        ["","","ことり","ことりさん","花丸","ルビィ","ダイヤ","せつ菜","璃奈","しずく","栞子","","","","","","","","","","",""],
        ["","","ことり","ことり先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","ことり","ことり","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","ことり","ミナリンスキー","鞠莉","","","","","","","","","","","","","","","","",""],
        ["","","海未","海未ちゃん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","果南","歩夢","彼方","エマ","果林","侑","","","",""],
        ["","","海未","海未さん","花丸","ルビィ","ダイヤ","せつ菜","璃奈","しずく","栞子","","","","","","","","","","",""],
        ["","","海未","海未先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","海未","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","","",""],
        ["","","凛","凛ちゃん","穂乃果","ことり","花陽","希","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","璃奈","彼方","エマ","果林","侑","",""],
        ["","","凛","凛さん","ダイヤ","せつ菜","しずく","栞子","","","","","","","","","","","","","",""],
        ["","","凛","凛","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","凛","りん子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","真姫","真姫ちゃん","穂乃果","ことり","凛","花陽","希","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","璃奈","彼方","エマ","果林","侑","かすみ"],
        ["","","真姫","真姫さん","ダイヤ","せつ菜","しずく","栞子","","","","","","","","","","","","","",""],
        ["","","真姫","真姫","海未","にこ","絵里","善子","鞠莉","嵐珠","ミア","","","","","","","","","","",""],
        ["","","真姫","まき子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","真姫","マッキー","愛","","","","","","","","","","","","","","","","",""],
        ["","","希","希ちゃん","穂乃果","ことり","凛","花陽","果南","彼方","エマ","果林","","","","","","","","","",""],
        ["","","希","希さん","千歌","曜","梨子","花丸","ルビィ","ダイヤ","歩夢","せつ菜","璃奈","しずく","栞子","侑","","","","","",""],
        ["","","希","希先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","希","希","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","花陽","花陽ちゃん","穂乃果","ことり","希","千歌","曜","梨子","花丸","ルビィ","果南","歩夢","かすみ","璃奈","彼方","エマ","果林","侑","",""],
        ["","","花陽","花陽さん","ダイヤ","せつ菜","しずく","栞子","","","","","","","","","","","","","",""],
        ["","","花陽","花陽","海未","真姫","にこ","絵里","善子","鞠莉","愛","嵐珠","ミア","","","","","","","","",""],
        ["","","花陽","かよ子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","花陽","はな子","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","花陽","かよちん","凛","","","","","","","","","","","","","","","","",""],
        ["","","にこ","にこちゃん","穂乃果","ことり","凛","花陽","真姫","果南","彼方","エマ","果林","","","","","","","","",""],
        ["","","にこ","にこさん","千歌","曜","梨子","花丸","ルビィ","ダイヤ","歩夢","せつ菜","璃奈","しずく","栞子","侑","","","","","",""],
        ["","","にこ","にこっち","希","鞠莉","愛","","","","","","","","","","","","","","",""],
        ["","","にこ","にこ先輩","かすみ","","","","","","","","","","","","","","","","",""],
        ["","","にこ","にこ","海未","絵里","善子","嵐珠","ミア","","","","","","","","","","","","",""],
        ["","","かのん","かのんちゃん","千砂都","","","","","","","","","","","","","","","","",""],
        ["","","かのん","かのんさん","恋","","","","","","","","","","","","","","","","",""],
        ["","","かのん","かのん先輩","きな子","メイ","四季","夏美","","","","","","","","","","","","","",""],
        ["","","かのん","かのん","可可","すみれ","","","","","","","","","","","","","","","",""],
        ["","","可可","可可ちゃん","かのん","千砂都","","","","","","","","","","","","","","","",""],
        ["","","可可","可可さん","恋","","","","","","","","","","","","","","","","",""],
        ["","","可可","可可先輩","きな子","メイ","四季","夏美","","","","","","","","","","","","","",""],
        ["","","可可","可可","可可","すみれ","","","","","","","","","","","","","","","",""],
        ["","","千砂都","ちぃちゃん","かのん","","","","","","","","","","","","","","","","",""],
        ["","","千砂都","千砂都さん","恋","","","","","","","","","","","","","","","","",""],
        ["","","千砂都","千砂都先輩","きな子","メイ","四季","夏美","","","","","","","","","","","","","",""],
        ["","","千砂都","千砂都","可可","すみれ","","","","","","","","","","","","","","","",""],
        ["","","すみれ","すみれちゃん","かのん","千砂都","","","","","","","","","","","","","","","",""],
        ["","","すみれ","すみれさん","恋","","","","","","","","","","","","","","","","",""],
        ["","","すみれ","すみれ先輩","きな子","メイ","四季","夏美","","","","","","","","","","","","","",""],
        ["","","すみれ","すみれ","可可","","","","","","","","","","","","","","","","",""],
        ["","","恋","恋先輩","きな子","メイ","四季","夏美","","","","","","","","","","","","","",""],
        ["","","恋","恋ちゃん","かのん","千砂都","","","","","","","","","","","","","","","",""],
        ["","","恋","レンレン","可可","","","","","","","","","","","","","","","","",""],
        ["","","恋","恋","すみれ","","","","","","","","","","","","","","","","",""],
        ["","","きな子","きな子さん","恋","","","","","","","","","","","","","","","","",""],
        ["","","きな子","きな子ちゃん","かのん","千砂都","四季","","","","","","","","","","","","","","",""],
        ["","","きな子","きなきな","可可","","","","","","","","","","","","","","","","",""],
        ["","","きな子","きな子","すみれ","きな子","メイ","","","","","","","","","","","","","","",""],
        ["","","メイ","メイさん","恋","","","","","","","","","","","","","","","","",""],
        ["","","メイ","メイちゃん","かのん","千砂都","きな子","","","","","","","","","","","","","","",""],
        ["","","メイ","メイメイ","可可","","","","","","","","","","","","","","","","",""],
        ["","","メイ","メイ","すみれ","四季","夏美","","","","","","","","","","","","","","",""],
        ["","","四季","四季さん","恋","","","","","","","","","","","","","","","","",""],
        ["","","四季","四季ちゃん","かのん","千砂都","きな子","","","","","","","","","","","","","","",""],
        ["","","四季","四季","すみれ","メイ","可可","夏美","","","","","","","","","","","","","",""],
        ["","","夏美","夏美さん","恋","","","","","","","","","","","","","","","","",""],
        ["","","夏美","夏美ちゃん","かのん","千砂都","きな子","四季","","","","","","","","","","","","","",""],
        ["","","夏美","夏美","すみれ","メイ","可可","","","","","","","","","","","","","","",""]
      ]


      //格納データ　オフセット
      face_offset = 11 //-1グループ名
      cha_offset = 1 //2行目
      call_r_offset = 1
      call_c_offset = 2

      var select_face = ""
      var select_name = ""//選択　判別用　初期値
      var tf = true
      var al3 = false//③事前データ判別用　" "

      //選択番号
      var group_num1 = cha_offset
      var face_num1 = face_offset
      var cha_num1 = cha_offset
      var group_name1 = cha_data[cha_offset][face_offset-1]
      var face1 = cha_data[cha_offset][face_offset]
      var hint1 = ""

      var group_num2 = cha_offset
      var face_num2 = face_offset
      var cha_num2 = cha_offset
      var group_name2 = cha_data[cha_offset][face_offset-1]
      var face2 = cha_data[cha_offset][face_offset]
      var hint2 = ""

      var group_num3 = cha_offset
      var face_num3 = face_offset
      var cha_num3 = cha_offset
      var group_name3 = cha_data[cha_offset][face_offset-1]
      var face3 = cha_data[cha_offset][face_offset]
      var hint3 = ""
      
      var group_num4 = cha_offset
      var face_num4 = face_offset
      var cha_num4 = cha_offset
      var group_name4 = cha_data[cha_offset][face_offset-1]
      var face4 = cha_data[cha_offset][face_offset]
      var hint4 = ""

      var kakko1_num = 0
      var kakko1_b_array = ["「","（","『","　"]
      var kakko1_a_array = ["」","）","』","　"]
      var kakko1_b = kakko1_b_array[0]
      var kakko1_a = kakko1_a_array[0]
      var kakko = ""

      document.getElementById("id_btn_group1").value = group_name1
      document.getElementById("id_btn_group2").value = group_name2
      document.getElementById("id_btn_group3").value = group_name3
      document.getElementById("id_btn_group4").value = group_name4

      document.getElementById("id_btn_face1").value = face1
      document.getElementById("id_btn_face2").value = face2
      document.getElementById("id_btn_face3").value = face3
      document.getElementById("id_btn_face4").value = face4


      //グループ変更１
      //------------------------------------------------------
      function onButton_g1(){
        //グループナンバー　循環
        if (group_num1 < cha_data.length-1){
          group_num1 +=1

          while (group_name1 == cha_data[group_num1][face_offset-1]){
            if(group_num1 == cha_data.length-1){
              group_num1 = cha_offset
              break
            }
              group_num1 +=1 
          }

        }else if(group_num1 == cha_data.length-1){
          group_num1 = cha_offset
        }

        cha_num1 = group_num1
        face1 = cha_data[cha_num1][face_num1]
        while(face1 == ""){
          face_num1 -= 1
          face1 = cha_data[cha_num1][face_num1]
        }
        document.getElementById("id_btn_face1").value = face1
        group_name1 = cha_data[group_num1][face_offset-1]
        document.getElementById("id_btn_group1").value = group_name1
        onButton_face1()
      }

      //表情変更１
      //------------------------------------------------------
      function onButton_l1(){//表情　逆方向
        if(face_num1 > face_offset){
          face_num1 -= 1
        }else{
          face_num1 = cha_data[0].length-1
        }

        //キャラオーバーフロー回避
        // if(cha_data.length - 1 < cha_num1){
        //     cha_num1 = cha_name_data[0].size-1
        // }

        //番号をもとにキャラ、表情をセット
        face1 = cha_data[cha_num1][face_num1]
        while(face1 == ""){
          face_num1 -= 1
          face1 = cha_data[cha_num1][face_num1]
        }
        // select_face = face1
        document.getElementById("id_btn_face1").value = face1
        // document.getElementById("id_textbox1").focus()
        onButton_face1()
      }//----------------------------------------------------
      function onButton_r1(){//表情　順方向
        if(cha_data[0].length - 1 > face_num1){
          face_num1 += 1
        }else{
          face_num1 = face_offset
        }

        //キャラオーバーフロー回避
        // if(cha_data.length - 1 < cha_num1){
        //     cha_num1 = cha_name_data[0].size-1
        // }

        //番号をもとにキャラ、表情をセット
        face1 = cha_data[cha_num1][face_num1]
        if(face1 == ""){
          face_num1 = face_offset
          face1 = cha_data[cha_num1][face_num1]
        }
        // select_face = face1
        document.getElementById("id_btn_face1").value = face1
        // document.getElementById("id_textbox1").focus()
        onButton_face1()
      }//----------------------------------------------------


      //キャラ変更１
      //------------------------------------------------------
      function onButton_u1(){//キャラ　逆方向
        if (cha_num1 > cha_offset){
          if (cha_data[cha_num1-1][face_offset-1] == group_name1){
            cha_num1 -=1
          }else{//リバース
            while (cha_data[cha_num1+1][face_offset-1] == group_name1){
              cha_num1 +=1
              if(cha_num1 == cha_data.length-1) break//追加コード
            }
          }
        }else if(cha_num1 == cha_offset){
          while (cha_data[cha_num1+1][face_offset-1] == group_name1){
              cha_num1 +=1
              if(cha_num1 == cha_data.length-1) break//追加コード
            }
        }

        face1 = cha_data[cha_num1][face_num1]
        while(face1 == ""){
          face_num1 -= 1
          face1 = cha_data[cha_num1][face_num1]
        }
        // select_face = face1
        document.getElementById("id_btn_face1").value = face1
        // document.getElementById("id_textbox1").focus()
        onButton_face1()
      }//----------------------------------------------------
      
      function onButton_d1(){//キャラ　順方向
        if(cha_data.length-1 > cha_num1){
          if (cha_data[cha_num1+1][face_offset-1] == group_name1){
            cha_num1 +=1
          }else{//リバース
            while (cha_data[cha_num1-1][face_offset-1] == group_name1){
              cha_num1 -=1
            }
          }
        }else if(cha_data.length-1 == cha_num1){
          while (cha_data[cha_num1-1][face_offset-1] == group_name1){
              cha_num1 -=1
            }
        }

        face1 = cha_data[cha_num1][face_num1]
        while(face1 == ""){
          face_num1 -= 1
          face1 = cha_data[cha_num1][face_num1]
        }
        // select_face = face1
        document.getElementById("id_btn_face1").value = face1
        // document.getElementById("id_textbox1").focus()
        onButton_face1()
      }//----------------------------------------------------


      //キャラ 選択１
      //------------------------------------------------------
      function onButton_face1(){
        onButton_reset()
        select_line_save = 1
        document.getElementById("id_btn_face1").disabled = true
        select_face = face1
        select_name = cha_data[cha_num1][face_offset]
        // document.getElementById("id_btn_face1").style.backgroundColor = "#ffffff"
        document.getElementById("id_textbox1").focus()
        hint_view(cha_num1,face_num1)
      }


      //------------------------------------------------------
      //::::::::::::::::::::::::::::::::::::::::::::::::::::::
      //------------------------------------------------------


      //グループ変更２
      //------------------------------------------------------
      function onButton_g2(){
        //グループナンバー　循環        
        if (group_num2 < cha_data.length-1){
          group_num2 +=1

          while (group_name2 == cha_data[group_num2][face_offset-1]){
            if(group_num2 == cha_data.length-1){
              group_num2 = cha_offset
              break
            }
              group_num2 +=1 
          }

        }else if(group_num2 == cha_data.length-1){
          group_num2 = cha_offset
        }

        cha_num2 = group_num2
        face2 = cha_data[cha_num2][face_num2]
        while(face2 == ""){
          face_num2 -= 1
          face2 = cha_data[cha_num2][face_num2]
        }
        document.getElementById("id_btn_face2").value = face2
        group_name2 = cha_data[group_num2][face_offset-1]
        document.getElementById("id_btn_group2").value = group_name2
        onButton_face2()
      }

      //表情変更２
      //------------------------------------------------------
      function onButton_l2(){//表情　逆方向
        if(face_num2 > face_offset){
          face_num2 -= 1
        }else{
          face_num2 = cha_data[0].length-1
        }

        //番号をもとにキャラ、表情をセット
        face2 = cha_data[cha_num2][face_num2]
        while(face2 == ""){
          face_num2 -= 1
          face2 = cha_data[cha_num2][face_num2]
        }
        // select_face = face2
        document.getElementById("id_btn_face2").value = face2
        // document.getElementById("id_textbox1").focus()
        onButton_face2()
      }//----------------------------------------------------
      function onButton_r2(){//表情　順方向
        if(cha_data[0].length - 1 > face_num2){
          face_num2 += 1
        }else{
          face_num2 = face_offset
        }

        //番号をもとにキャラ、表情をセット
        face2 = cha_data[cha_num2][face_num2]
        if(face2 == ""){
          face_num2 = face_offset
          face2 = cha_data[cha_num2][face_num2]
        }
        // select_face = face2
        document.getElementById("id_btn_face2").value = face2
        // document.getElementById("id_textbox1").focus()
        onButton_face2()
      }//----------------------------------------------------


      //キャラ変更２
      //------------------------------------------------------
      function onButton_u2(){//キャラ　逆方向
        if (cha_num2 > cha_offset){
          if (cha_data[cha_num2-1][face_offset-1] == group_name2){
            cha_num2 -=1
          }else{//リバース
            while (cha_data[cha_num2+1][face_offset-1] == group_name2){
              cha_num2 +=1
              if(cha_num2 == cha_data.length-1) break//追加コード
            }
          }
        }else if(cha_num2 == cha_offset){
          while (cha_data[cha_num2+1][face_offset-1] == group_name2){
              cha_num2 +=1
              if(cha_num2 == cha_data.length-1) break//追加コード
            }
        }

        face2 = cha_data[cha_num2][face_num2]
        while(face2 == ""){
          face_num2 -= 1
          face2 = cha_data[cha_num2][face_num2]
        }

        // select_face = face2
        document.getElementById("id_btn_face2").value = face2
        // document.getElementById("id_textbox1").focus()
        onButton_face2()
      }//----------------------------------------------------
      
      function onButton_d2(){//キャラ　順方向
        if(cha_data.length-1 > cha_num2){
          if (cha_data[cha_num2+1][face_offset-1] == group_name2){
            cha_num2 +=1
          }else{//リバース
            while (cha_data[cha_num2-1][face_offset-1] == group_name2){
              cha_num2 -=1
            }
          }
        }else if(cha_data.length-1 == cha_num2){
          while (cha_data[cha_num2-1][face_offset-1] == group_name2){
              cha_num2 -=1
            }
        }

        face2 = cha_data[cha_num2][face_num2]
        while(face2 == ""){
          face_num2 -= 1
          face2 = cha_data[cha_num2][face_num2]
        }

        // select_face = face2
        document.getElementById("id_btn_face2").value = face2
        // document.getElementById("id_textbox1").focus()
        onButton_face2()
      }//----------------------------------------------------


      //キャラ 選択２
      //------------------------------------------------------
      function onButton_face2(){
        onButton_reset()
        select_line_save = 2
        document.getElementById("id_btn_face2").disabled = true
        select_face = face2
        select_name = cha_data[cha_num2][face_offset]
        // document.getElementById("id_btn_face2").style.backgroundColor = "#ffffff"
        document.getElementById("id_textbox1").focus()
        hint_view(cha_num2,face_num2)
      }

      //------------------------------------------------------
      //::::::::::::::::::::::::::::::::::::::::::::::::::::::
      //------------------------------------------------------


      //グループ変更３
      //------------------------------------------------------
      function onButton_g3(){
        //グループナンバー　循環        
        if (group_num3 < cha_data.length-1){
          group_num3 +=1

          while (group_name3 == cha_data[group_num3][face_offset-1]){
            if(group_num3 == cha_data.length-1){
              group_num3 = cha_offset
              break
            }
              group_num3 +=1 
          }

        }else if(group_num3 == cha_data.length-1){
          group_num3 = cha_offset
        }

        cha_num3 = group_num3
        face3 = cha_data[cha_num3][face_num3]
        while(face3 == ""){
          face_num3 -= 1
          face3 = cha_data[cha_num3][face_num3]
        }
        document.getElementById("id_btn_face3").value = face3
        group_name3 = cha_data[group_num3][face_offset-1]
        document.getElementById("id_btn_group3").value = group_name3
        onButton_face3()
      }

      //表情変更３
      //------------------------------------------------------
      function onButton_l3(){//表情　逆方向
        if(face_num3 > face_offset){
          face_num3 -= 1
        }else{
          face_num3 = cha_data[0].length-1
        }

        //番号をもとにキャラ、表情をセット
        face3 = cha_data[cha_num3][face_num3]
        while(face3 == ""){
          face_num3 -= 1
          face3 = cha_data[cha_num3][face_num3]
        }
        document.getElementById("id_btn_face3").value = face3
        onButton_face3()
      }//----------------------------------------------------
      function onButton_r3(){//表情　順方向
        if(cha_data[0].length - 1 > face_num3){
          face_num3 += 1
        }else{
          face_num3 = face_offset
        }

        //番号をもとにキャラ、表情をセット
        face3 = cha_data[cha_num3][face_num3]
        if(face3 == ""){
          face_num3 = face_offset
          face3 = cha_data[cha_num3][face_num3]
        }
        document.getElementById("id_btn_face3").value = face3
        onButton_face3()
      }//----------------------------------------------------


      //キャラ変更３
      //------------------------------------------------------
      function onButton_u3(){//キャラ　逆方向
        if (cha_num3 > cha_offset){
          if (cha_data[cha_num3-1][face_offset-1] == group_name3){
            cha_num3 -=1
          }else{//リバース
            while (cha_data[cha_num3+1][face_offset-1] == group_name3){
              cha_num3 +=1
              if(cha_num3 == cha_data.length-1) break//追加コード
            }
          }
        }else if(cha_num3 == cha_offset){
          while (cha_data[cha_num3+1][face_offset-1] == group_name3){
              cha_num3 +=1
              if(cha_num3 == cha_data.length-1) break//追加コード
            }
        }

        face3 = cha_data[cha_num3][face_num3]
        while(face3 == ""){
          face_num3 -= 1
          face3 = cha_data[cha_num3][face_num3]
        }
        document.getElementById("id_btn_face3").value = face3
        onButton_face3()
      }//----------------------------------------------------
      
      function onButton_d3(){//キャラ　順方向
        if(cha_data.length-1 > cha_num3){
          if (cha_data[cha_num3+1][face_offset-1] == group_name3){
            cha_num3 +=1
          }else{//リバース
            while (cha_data[cha_num3-1][face_offset-1] == group_name3){
              cha_num3 -=1
            }
          }
        }else if(cha_data.length-1 == cha_num3){
          while (cha_data[cha_num3-1][face_offset-1] == group_name3){
              cha_num3 -=1
            }
        }

        face3 = cha_data[cha_num3][face_num3]
        while(face3 == ""){
          face_num3 -= 1
          face3 = cha_data[cha_num3][face_num3]
        }
        document.getElementById("id_btn_face3").value = face3
        onButton_face3()
      }//----------------------------------------------------


      //キャラ 選択３
      //------------------------------------------------------
      function onButton_face3(){
        onButton_reset()
        select_line_save = 3
        document.getElementById("id_btn_face3").disabled = true
        select_face = face3
        select_name = cha_data[cha_num3][face_offset]
        // document.getElementById("id_btn_face3").style.backgroundColor = "#ffffff"
        document.getElementById("id_textbox1").focus()
        hint_view(cha_num3,face_num3)
      }


      //------------------------------------------------------
      //::::::::::::::::::::::::::::::::::::::::::::::::::::::
      //------------------------------------------------------


      //グループ変更４
      //------------------------------------------------------
      function onButton_g4(){
        //グループナンバー　循環        
        if (group_num4 < cha_data.length-1){
          group_num4 +=1

          while (group_name4 == cha_data[group_num4][face_offset-1]){
            if(group_num4 == cha_data.length-1){
              group_num4 = cha_offset
              break
            }
              group_num4 +=1 
          }

        }else if(group_num4 == cha_data.length-1){
          group_num4 = cha_offset
        }

        cha_num4 = group_num4
        face4 = cha_data[cha_num4][face_num4]
        while(face4 == ""){
          face_num4 -= 1
          face4 = cha_data[cha_num4][face_num4]
        }
        document.getElementById("id_btn_face4").value = face4
        group_name4 = cha_data[group_num4][face_offset-1]
        document.getElementById("id_btn_group4").value = group_name4
        onButton_face4()
      }

      //表情変更４
      //------------------------------------------------------
      function onButton_l4(){//表情　逆方向
        if(face_num4 > face_offset){
          face_num4 -= 1
        }else{
          face_num4 = cha_data[0].length-1
        }

        //番号をもとにキャラ、表情をセット
        face4 = cha_data[cha_num4][face_num4]
        while(face4 == ""){
          face_num4 -= 1
          face4 = cha_data[cha_num4][face_num4]
        }
        document.getElementById("id_btn_face4").value = face4
        onButton_face4()
      }//----------------------------------------------------
      function onButton_r4(){//表情　順方向
        if(cha_data[0].length - 1 > face_num4){
          face_num4 += 1
        }else{
          face_num4 = face_offset
        }

        //番号をもとにキャラ、表情をセット
        face4 = cha_data[cha_num4][face_num4]
        if(face4 == ""){
          face_num4 = face_offset
          face4 = cha_data[cha_num4][face_num4]
        }
        document.getElementById("id_btn_face4").value = face4
        onButton_face4()
      }//----------------------------------------------------


      //キャラ変更４
      //------------------------------------------------------
      function onButton_u4(){//キャラ　逆方向
        if (cha_num4 > cha_offset){
          if (cha_data[cha_num4-1][face_offset-1] == group_name4){
            cha_num4 -=1
          }else{//リバース
            while (cha_data[cha_num4+1][face_offset-1] == group_name4){
              cha_num4 +=1
              if(cha_num4 == cha_data.length-1) break//追加コード
            }
          }
        }else if(cha_num4 == cha_offset){
          while (cha_data[cha_num4+1][face_offset-1] == group_name4){
              cha_num4 +=1
              if(cha_num4 == cha_data.length-1) break//追加コード
            }
        }

        face4 = cha_data[cha_num4][face_num4]
        while(face4 == ""){
          face_num4 -= 1
          face4 = cha_data[cha_num4][face_num4]
        }        
        document.getElementById("id_btn_face4").value = face4
        onButton_face4()
      }//----------------------------------------------------
      
      function onButton_d4(){//キャラ　順方向
        if(cha_data.length-1 > cha_num4){
          if (cha_data[cha_num4+1][face_offset-1] == group_name4){
            cha_num4 +=1
          }else{//リバース
            while (cha_data[cha_num4-1][face_offset-1] == group_name4){
              cha_num4 -=1
            }
          }
        }else if(cha_data.length-1 == cha_num4){
          while (cha_data[cha_num4-1][face_offset-1] == group_name4){
              cha_num4 -=1
            }
        }

        face4 = cha_data[cha_num4][face_num4]


        while(face4 == ""){
          face_num4 -= 1
          face4 = cha_data[cha_num4][face_num4]
        }
        document.getElementById("id_btn_face4").value = face4
        onButton_face4()
      }//----------------------------------------------------


      //キャラ 選択４
      //------------------------------------------------------
      function onButton_face4(){
        onButton_reset()
        select_line_save = 4
        document.getElementById("id_btn_face4").disabled = true

        select_face = face4
        select_name = cha_data[cha_num4][face_offset]
        // document.getElementById("id_btn_face4").style.backgroundColor = "#ffffff"
        document.getElementById("id_textbox1").focus()
        hint_view(cha_num4,face_num4)
      }







      //------------------------------------------------------------------------
      //書き込み
      function onButton_w1(){
        var elements = document.getElementById("id_textbox1").value//入力
        var b_alltext = document.getElementById("id_text_box").value//
        input_back = elements
        textbox_back = b_alltext

        var a_alltext = b_alltext//すでに書き込み済みのデータを取り込む
        if (b_alltext != "") a_alltext = a_alltext + "\n\n" //追記する場合は改行をする
        var a_alltext = a_alltext + select_face + kakko1_b + elements + kakko1_a//新規内容追加

        document.getElementById("id_text_box").value = a_alltext
        document.getElementById("id_text_box").scrollTop = document.getElementById("id_text_box").scrollHeight
        del_tmp = a_alltext
        
        onInput_text_box()
        
        //記入欄　初期化
        document.forms.id_form1.id_textbox1.value = ""
        document.getElementById("id_textbox1").style.backgroundColor = "#ffffff"
        
        //フォーカス
        cleave_count()
        document.getElementById("id_textbox1").focus()
      }


      //括弧の選択
      function onButton_kakko1(){
        if (kakko1_b_array.length-1 > kakko1_num){
          kakko1_num += 1
        }else{
          kakko1_num = 0
        }

        kakko1_b = kakko1_b_array[kakko1_num]
        kakko1_a = kakko1_a_array[kakko1_num]
        kakko = kakko1_b + kakko1_a

        document.getElementById("id_btn_kakko1").value = kakko
        document.getElementById("id_textbox1").focus()
      }


      //分割点カット
      function onButton_c_cut(){
        var cut_str =""
        var cut_a_str = ""
        var cut_point = -1
        var re_point
        textbox_back = document.getElementById("id_text_box").value
        var cut_array = textbox_back.split("\n")

        for(i=0; i<=cut_array.length-1; i++){//位置確認
          if(c_word == cut_array[i]){
            cut_point = i
            break
          }
        }

        if(cut_point != -1){//カットポイントあり
          //戻す用
          if(cut_array.length-1 > cut_point){//オーバーフロー回避
            re_point = cut_point
            if(cut_array[cut_point+1] == ""){
              re_point +=1
            }

            for(i=re_point+1; i<=cut_array.length-1; i++){
              if(cut_a_str != "")cut_a_str = cut_a_str  + "\n"
              cut_a_str = cut_a_str + cut_array[i]
            }
          }

          if(cut_point > 2){//カット位置直上の空白は削除 カットポイント上蓋ちゃうからこっち先
            if(cut_array[cut_point-1] == "") cut_point -=2
          }

          for(i=cut_point; i>=0; i--){//カット分
            if(i != cut_point) cut_str = "\n" + cut_str
            if(cut_array[i] != c_word){
              cut_str = cut_array[i] + cut_str
            }
          }
          // navigator.clipboard.writeText(cut_str)//コピー

          document.getElementById("id_text_box").value = cut_str//取り敢えずコピー
          onButton_copy()
          document.getElementById("id_text_box").value = cut_a_str

        }else if(cut_point == -1){//カットポイントなし
          onButton_copy()
          document.getElementById("id_text_box").value = ""
        }

        onInput_text_box()
        
      }


      //追記前に戻る
      function onButton_back(){
        document.getElementById("id_text_box").value = textbox_back
        document.getElementById("id_textbox1").value = input_back
        document.getElementById("id_textbox1").focus()
        onInput_text_box()
      }

      //消去
      function onButton_del(){
        if (document.getElementById("id_text_box").value != ""){
          del_tmp = document.getElementById("id_text_box").value
          document.getElementById("id_text_box").value = ""
        }else{
          document.getElementById("id_text_box").value = del_tmp
          document.getElementById("id_textbox1").focus()
        }
        onInput_text_box()
      }

      //テキスト入力時　メイン
      function onInput_text_box(){
        var txt_str = document.getElementById("id_text_box").value
        var rows_num = txt_str.split("\n").length
        document.getElementById("id_rows_byte_txt").value = rows_num.toString() + " 行 / " + txt_str.replace(/%../g,"*").length.toString() + " byte"
        cleave_count()
      }

      //テキスト入力時　追記（入力）用
      function onInput_textbox1(){
        chk_input = document.getElementById("id_textbox1").value

        for(i=call_r_offset; i<=call_data.length-1; i++){//呼ばれ方走査
          chk_call = call_data[i][call_c_offset+1]

          if(chk_input.lastIndexOf(chk_call) != -1){//チェックすべき呼称を含む
            for(j=call_c_offset+2; j<=call_data[0].length-1; j++){//人物一致確認

              if(select_name == call_data[i][j]){
                 tf = true
                 break
              }else{
                tf = false
              }

            }
            break
          }else{
            tf = true
          }
        }

        if(tf == false){
          document.getElementById("id_textbox1").style.backgroundColor = "#ffaaaa"
        }else if(tf == true){
          document.getElementById("id_textbox1").style.backgroundColor = "#ffffff"
        }
      }

      //コピー
      function onButton_copy(){        
        document.getElementById("id_text_box").select()
        document.execCommand("copy")//非推奨　スマホ用 http

        // document.getElementById("id_text_box").focus()
        // document.getElementById("id_text_box").scrollTop = document.getElementById("id_text_box").scrollHeight

        // var copy_str =""
        // copy_str = document.getElementById("id_text_box").value
        // navigator.clipboard.writeText(copy_str)
        
        // document.getElementById("id_textbox1").focus()
      }

      //分割点　追加
      function onButton_c_point(){
        var b_alltext = document.getElementById("id_text_box").value//
        var a_alltext = ""//書き込み後文字列
        input_back = ""
        textbox_back = b_alltext

        var c_value = document.getElementById("id_c_row").value

        if(c_value == "c"){//クリアコマンド
          var c_all_array = b_alltext.split("\n")
          document.getElementById("id_c_row").value = ""
          for(i=0; i<=c_all_array.length-1; i++){
            
            if(i != c_all_array.length-1){//配列の先頭でない
              if(c_all_array[c_all_array.length-1-i] == c_word){//分割文字列と一致
                i +=1//読み飛ばす
                if(c_all_array[c_all_array.length-1-i] == "") i +=1
              }

              a_alltext = c_all_array[c_all_array.length-1-i] + "\n" + a_alltext

            }else{//先頭
              if(c_all_array[c_all_array.length-1-i] != "" && c_all_array[c_all_array.length-1-i] != c_word){//空白、分割文字列以外なら書き込み
                a_alltext = c_all_array[c_all_array.length-1-i] + "\n" + a_alltext
              }
            }

          }
        }else if(c_value == ""){//ココまでクリアコマンド
          a_alltext = b_alltext//すでに書き込み済みのデータを取り込む
          if (b_alltext != "") a_alltext = a_alltext + "\n\n" //追記する場合は改行をする
          a_alltext = a_alltext + c_word//分割文字列追加
        }
        
        document.getElementById("id_text_box").value = a_alltext
        del_tmp = a_alltext
        
        onInput_text_box()

        //フォーカス
        document.getElementById("id_text_box").scrollTop = document.getElementById("id_text_box").scrollHeight
        document.getElementById("id_textbox1").focus()
      }


      //選択リセット
      function onButton_reset(){
        select_face = ""
        select_name = ""
        select_line_save = 0

        document.getElementById("id_btn_face1").disabled = false
        document.getElementById("id_btn_face2").disabled = false
        document.getElementById("id_btn_face3").disabled = false
        document.getElementById("id_btn_face4").disabled = false

        document.getElementById("id_textbox1").placeholder = ""//ヒント初期化
      }


      function hint_view(cha_num,face_num){
        hint1 = ""
        al3 = false

        //１，２人称
        hint1 = hint1 + "①" + cha_data[cha_num][face_offset-3]
        if (hint1 != "") hint1 = hint1 + "　"
        hint1 = hint1 + "②" + cha_data[cha_num][face_offset-2]

        if (hint1 != "") hint1 = hint1 + "\n"
        hint1 = hint1 + "③" 

        //呼称----------------------------------------------------------------------
        //1行目 face1
        if(select_name != cha_data[cha_num1][face_offset]){//選択キャラと不一致
          for(i=call_r_offset; i<=call_data.length-1; i++){
            if(call_data[i][call_c_offset] == cha_data[cha_num1][face_offset]){//呼ばれる対象一致
              for(j=call_c_offset+2; j<call_data[0].length-1; j++){
                if(select_name == call_data[i][j]){//選択対象発見
                  hint1 = hint1 + call_data[i][call_c_offset+1]
                  al3 = true
                }
              }
            } 
          }
        }

        if(select_name != cha_data[cha_num2][face_offset]){//選択キャラと不一致
          for(i=call_r_offset; i<=call_data.length-1; i++){
            if(call_data[i][call_c_offset] == cha_data[cha_num2][face_offset]){//呼ばれる対象一致
              for(j=call_c_offset+2; j<call_data[0].length-1; j++){
                if(select_name == call_data[i][j]){//選択対象発見
                  if(al3 == true) hint1 = hint1 + "、"
                  hint1 = hint1 + call_data[i][call_c_offset+1]
                  al3 = true
                }
              }
            } 
          }
        }

        if(select_name != cha_data[cha_num3][face_offset]){//選択キャラと不一致
          for(i=call_r_offset; i<=call_data.length-1; i++){
            if(call_data[i][call_c_offset] == cha_data[cha_num3][face_offset]){//呼ばれる対象一致
              for(j=call_c_offset+2; j<call_data[0].length-1; j++){
                if(select_name == call_data[i][j]){//選択対象発見
                  if(al3 == true) hint1 = hint1 + "、"
                  hint1 = hint1 + call_data[i][call_c_offset+1]
                  al3 = true
                }
              }
            } 
          }
        }

        if(select_name != cha_data[cha_num4][face_offset]){//選択キャラと不一致
          for(i=call_r_offset; i<=call_data.length-1; i++){
            if(call_data[i][call_c_offset] == cha_data[cha_num4][face_offset]){//呼ばれる対象一致
              for(j=call_c_offset+2; j<call_data[0].length-1; j++){
                if(select_name == call_data[i][j]){//選択対象発見
                  if(al3 == true) hint1 = hint1 + "、"
                  hint1 = hint1 + call_data[i][call_c_offset+1]
                  al3 = true
                }
              }
            } 
          }
        }
        document.getElementById("id_textbox1").placeholder = hint1
      }
      //--------------------------------------------------------------------------


      //直前分割点からの行数
      function cleave_count(){
        var all_array = document.getElementById("id_text_box").value.split("\n")

        c_count = 0
        for(i=0; i<=all_array.length-1; i++){
          if(c_word == all_array[i]){
            c_count = 0
          }else{
            c_count += 1
            if(i>1 && c_word == all_array[i-2] && all_array[i-1] == ""){
              c_count = 1
            }
          }
        }
        document.getElementById("id_c_row").placeholder = "直前の分割場所から　" + c_count.toString() + "行"
      }


      //ファイル      
      async function handleFile(e){
        var file = e.target.files[0]   
        var data = await file.arrayBuffer()
        var workbook = XLSX.read(data)

        var sheet1 = workbook.Sheets["name"]
        var sheet2 = workbook.Sheets["call"]

        // console.log(range.e.r.toString() + range.e.c.toString())
        function sheet_to_arr(sheet){
          var cn = ""
          var cell_str =""
          var arr = Array()
          var range = XLSX.utils.decode_range(sheet["!ref"])

          // console.log(range.e.r)

          for(var row=range.s.r; row<=range.e.r; row++){
            arr[row] = Array()
            for(var col=range.s.c; col<=range.e.c; col++){
              cn = XLSX.utils.encode_cell({r:row, c:col})//セル変換
              if(sheet[cn] != undefined){
                cell_str = sheet[cn].w              
              }else{
                cell_str = ""
              }
              arr[row][col] = cell_str
              // console.log(arr[row][col])
            }
          }

          return arr
        }

        cha_data = []
        call_data = []
        
        // cha_data.length = 0
        // call_data.length = 0

        cha_data = sheet_to_arr(sheet1)
        call_data = sheet_to_arr(sheet2)

        // console.log(cha_data)

        await ini_fun()              
      }
      document.getElementById("id_read").addEventListener("change", handleFile, false)


      //キーボード　使ってないのはコメントアウト必須
      // document.addEventListener("keypress",keypressEvent)
      document.addEventListener("keydown",keydownEvent)
      // document.addEventListener("keyup",keyupEvent)

      function keydownEvent(e){

        if(e.ctrlKey === true){
          // ctrl_tf = true

          //elseのが速い
          if(e.key === "i"){
            e.key = null
            e.returnValue = false
            if(select_line_save == 1){
              onButton_u1()
            }else if(select_line_save == 2){
              onButton_u2()
            }else if(select_line_save == 3){
              onButton_u3()
            }else if(select_line_save == 4){
              onButton_u4()
            }

          }else if(e.key === "k"){
            e.key = null
            e.returnValue = false
            if(select_line_save == 1){
              onButton_d1()
            }else if(select_line_save == 2){
              onButton_d2()
            }else if(select_line_save == 3){
              onButton_d3()
            }else if(select_line_save ==4){
              onButton_d4()
            }

          }else if(e.key === "j"){
            e.key = null
            e.returnValue = false
            if(select_line_save == 1){
              onButton_l1()
            }else if(select_line_save == 2){
              onButton_l2()
            }else if(select_line_save == 3){
              onButton_l3()
            }else if(select_line_save == 4){
              onButton_l4()
            }

          }else if(e.key === "l"){
            e.key = null
            e.returnValue = false
            if(select_line_save == 1){
              onButton_r1()
            }else if(select_line_save == 2){
              onButton_r2()
            }else if(select_line_save == 3){
              onButton_r3()
            }else if(select_line_save == 4){
              onButton_r4()
            }

          }else if(e.key === "g"){
            e.key = null
            e.returnValue = false
            if(select_line_save == 1){
              onButton_g1()
            }else if(select_line_save == 2){
              onButton_g2()
            }else if(select_line_save == 3){
              onButton_g3()
            }else if(select_line_save == 4){
              onButton_g4()
            }

          }else if(e.key === "["){
            e.key = null
            e.returnValue = false
            onButton_kakko1()

          }else if(e.key === "Enter"){
            e.key = null
            e.returnValue = false
            onButton_w1()

          }else if(e.key === "Backspace"){
            e.key = null
            e.returnValue = false
            onButton_back()

          }


        }else if(e.key === "F1"){
          e.keyCode = null
          e.returnValue = false
          onButton_face1()
        }else if(e.key === "F2"){
          e.keyCode = null
          e.returnValue = false
          onButton_face2()
        }else if(e.key === "F3"){
          e.keyCode = null
          e.returnValue = false
          onButton_face3()
        }else if(e.key === "F4"){
          e.keyCode = null
          e.returnValue = false
          onButton_face4()
        }else if(e.key === "F5"){
          e.keyCode = null
          e.returnValue = false
          onButton_reset()
        }

        //非推奨
        // if(e.keyCode >= 112 && e.keyCode <= 116){
        //   e.keyCode = null
        //   e.returnValue = false

        //   switch(e.keyCode){
        //     //F1
        //     case 112:
        //       onButton_face1()
        //       break

        //     case 113:
        //       onButton_face2()
        //       break

        //     case 114:
        //       onButton_face3()
        //       break

        //     case 115:
        //       onButton_face4()
        //       break

        //     case 116:
        //       onButton_reset()
        //       break
        //   }
               
        return false
      }


      // function keypressEvent(e){//非推奨

      //   return false
      // }


      // function keyupEvent(e){

      // if(e.ctrlKey === true){
      //   ctrl_tf = false
      // }

      // return false
      // }


      //初期値変更

      function ini_fun(){

        group_num1 = cha_offset
        face_num1 = face_offset
        cha_num1 = cha_offset

        group_num2 = cha_offset
        face_num2 = face_offset
        cha_num2 = cha_offset

        group_num3 = cha_offset
        face_num3 = face_offset
        cha_num3 = cha_offset

        group_num4 = cha_offset
        face_num4 = face_offset
        cha_num4 = cha_offset

        group_name1 = cha_data[cha_offset][face_offset-1]
        face1 = cha_data[cha_offset][face_offset]

        group_name2 = cha_data[cha_offset][face_offset-1]
        face2 = cha_data[cha_offset][face_offset]

        group_name3 = cha_data[cha_offset][face_offset-1]
        face3 = cha_data[cha_offset][face_offset]

        group_name4 = cha_data[cha_offset][face_offset-1]
        face4 = cha_data[cha_offset][face_offset]

        document.getElementById("id_btn_group1").value = group_name1
        document.getElementById("id_btn_group2").value = group_name2
        document.getElementById("id_btn_group3").value = group_name3
        document.getElementById("id_btn_group4").value = group_name4

        document.getElementById("id_btn_face1").value = face1
        document.getElementById("id_btn_face2").value = face2
        document.getElementById("id_btn_face3").value = face3
        document.getElementById("id_btn_face4").value = face4

        onButton_g2()
        
        onButton_g3()
        onButton_g3()

        onButton_g4()
        onButton_g4()
        onButton_g4()

        onButton_reset()
      }

      ini_fun()


    </script>
</body>
